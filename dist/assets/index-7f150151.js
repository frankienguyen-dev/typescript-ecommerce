import{B,D as G,_ as U,E as v,F as Y,r as c,d as s,j as t,G as q,Q as A,A as H,a as J,o as Q,b as F,i as K,H as V,c as W,I as X,C as D,J as Z,K as ee,M as re}from"./index-00ae5234.js";import{u as y}from"./user.api-4479a433.js";import{I as R}from"./Input-85cedd63.js";import{I as te}from"./InputNumber-bdf05a35.js";var ae=Math.ceil,ne=Math.max;function se(r,e,a,n){for(var i=-1,d=ne(ae((e-r)/(a||1)),0),o=Array(d);d--;)o[n?d:++i]=r,r+=a;return o}var oe=se,ie=B,de=G,me=U,ce=v;function le(r,e,a){if(!ce(a))return!1;var n=typeof e;return(n=="number"?de(a)&&me(e,a.length):n=="string"&&e in a)?ie(a[e],r):!1}var he=le,fe=/\s/;function pe(r){for(var e=r.length;e--&&fe.test(r.charAt(e)););return e}var ge=pe,ue=ge,xe=/^\s+/;function be(r){return r&&r.slice(0,ue(r)+1).replace(xe,"")}var we=be,ye=we,S=v,Ne=Y,M=0/0,_e=/^[-+]0x[0-9a-f]+$/i,Ie=/^0b[01]+$/i,Ce=/^0o[0-7]+$/i,Fe=parseInt;function Se(r){if(typeof r=="number")return r;if(Ne(r))return M;if(S(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=S(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=ye(r);var a=Ie.test(r);return a||Ce.test(r)?Fe(r.slice(2),a?2:8):_e.test(r)?M:+r}var Me=Se,Ee=Me,E=1/0,ve=17976931348623157e292;function Ae(r){if(!r)return r===0?r:0;if(r=Ee(r),r===E||r===-E){var e=r<0?-1:1;return e*ve}return r===r?r:0}var De=Ae,Re=oe,je=he,N=De;function Pe(r){return function(e,a,n){return n&&typeof n!="number"&&je(e,a,n)&&(a=n=void 0),e=N(e),a===void 0?(a=e,e=0):a=N(a),n=n===void 0?e<a?1:-1:N(n),Re(e,a,n,r)}}var $e=Pe,Te=$e,ke=Te(),ze=ke;const _=ze;function Oe({onChange:r,value:e,errorMessage:a}){const[n,i]=c.useState({date:(e==null?void 0:e.getDate())||1,month:(e==null?void 0:e.getMonth())||0,year:(e==null?void 0:e.getFullYear())||1990});c.useEffect(()=>{e&&i({date:e==null?void 0:e.getDate(),month:e==null?void 0:e.getMonth(),year:e==null?void 0:e.getFullYear()})},[e]);const d=o=>{const{name:l,value:b}=o.target,h={date:(e==null?void 0:e.getDate())||n.date,month:(e==null?void 0:e.getMonth())||n.month,year:(e==null?void 0:e.getFullYear())||n.year,[l]:Number(b)};i(h),r&&r(new Date(h.year,h.month,h.date))};return s("div",{className:" mt-2 flex flex-col flex-wrap sm:flex-row",children:[t("div",{className:"w-full truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:"Ngày sinh:"}),s("div",{className:"mt-3 w-full sm:mt-0 sm:w-[80%] sm:pl-5",children:[s("div",{className:"flex justify-between gap-5",children:[s("select",{onChange:d,value:(e==null?void 0:e.getDate())||n.date,name:"date",className:`h-10 w-[32%] rounded-sm border border-black/10 pl-2 hover:cursor-pointer
         hover:border-orange`,children:[t("option",{disabled:!0,children:"Ngày"}),_(1,32).map(o=>s("option",{value:o,children:["Ngày ",o]},o))]}),s("select",{onChange:d,value:(e==null?void 0:e.getMonth())||n.month,name:"month",className:`h-10 w-[32%] rounded-sm border border-black/10 pl-2 hover:cursor-pointer
         hover:border-orange`,children:[t("option",{disabled:!0,children:"Tháng"}),_(0,12).map(o=>s("option",{value:o,children:["Tháng ",o+1]},o))]}),s("select",{onChange:d,value:(e==null?void 0:e.getFullYear())||n.year,name:"year",className:`h-10 w-[32%] rounded-sm border border-black/10
         pl-2 hover:cursor-pointer hover:border-orange`,children:[t("option",{disabled:!0,children:"Năm"}),_(1990,2024).map(o=>s("option",{value:o,children:["Năm ",o]},o))]})]}),t("div",{className:"mt-1 min-h-[1.25rem] text-sm text-red-600",children:a})]})]})}function Le({onChange:r}){const e=c.useRef(null),a=i=>{var o;const d=(o=i.target.files)==null?void 0:o[0];d&&(d.size>=q.maxSizeUploadAvatar||!d.type.includes("image"))&&A.error("Dụng lượng file tối đa 1 MB. Định dạng:.JPEG, .PNG",{autoClose:1e3}),r&&r(d)},n=()=>{var i;(i=e.current)==null||i.click()};return s(c.Fragment,{children:[t("input",{className:"hidden",type:"file",accept:".jpg,.jpeg,.png",ref:e,onChange:a,onClick:i=>{i.target.value=null}}),t("button",{className:`flex h-10 items-center justify-end rounded-sm border 
            bg-white px-6 text-sm text-gray-600 shadow-sm`,type:"button",onClick:n,children:"Chọn Ảnh"})]})}function Be(){var n;const{register:r,formState:{errors:e},control:a}=ee();return s(c.Fragment,{children:[s("div",{className:" mt-6 flex flex-col flex-wrap sm:flex-row",children:[t("div",{className:"w-full truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:"Tên:"}),t("div",{className:"mt-3 w-full sm:mt-0 sm:w-[80%] sm:pl-5",children:t(R,{classNameInput:`w-full rounded-sm border-[1px] border-gray-300 
              px-3 py-2 outline-none focus:border-gray-500 focus:shadow-sm`,placeholder:"Tên",name:"name",register:r,errorMessage:(n=e.name)==null?void 0:n.message})})]}),s("div",{className:" mt-2 flex flex-col flex-wrap sm:flex-row",children:[t("div",{className:"truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:"Số điện thoại:"}),t("div",{className:"mt-3 w-full sm:mt-0 sm:w-[80%] sm:pl-5",children:t(D,{control:a,name:"phone",render:({field:i})=>{var d;return t(te,{classNameInput:`w-full rounded-sm border-[1px] border-gray-300 
              px-3 py-2 outline-none focus:border-gray-500 focus:shadow-sm`,placeholder:"Số điện thoại",errorMessage:(d=e.phone)==null?void 0:d.message,...i,onChange:i.onChange})}})})]})]})}const Ge=re.pick(["name","avatar","phone","date_of_birth","address"]);function Qe(){var I;const{setProfile:r}=c.useContext(H),[e,a]=c.useState(),n=c.useMemo(()=>e?URL.createObjectURL(e):"",[e]);c.useRef(null);const i=J({defaultValues:{name:"",phone:"",address:"",avatar:"",date_of_birth:new Date(1990,0,1)},resolver:Q(Ge)}),{register:d,handleSubmit:o,setValue:l,control:b,formState:{errors:h},watch:j,setError:P}=i,$=j("avatar"),T=F(y.updateProfile),k=F(y.uploadAvatar),{data:w,refetch:z}=K({queryKey:["profiles"],queryFn:y.getProfile}),m=w==null?void 0:w.data.data;c.useEffect(()=>{m&&(l("name",m.name),l("phone",m.phone),l("address",m.address),l("avatar",m.avatar),l("date_of_birth",m.date_of_birth?new Date(m.date_of_birth):new Date(1990,0,1)))},[m,l]);const O=o(async f=>{var u,C;try{let g=$;if(e){const x=new FormData;x.append("image",e),g=(await k.mutateAsync(x)).data.data,l("avatar",g)}const p=await T.mutateAsync({...f,date_of_birth:(u=f.date_of_birth)==null?void 0:u.toISOString(),avatar:g});r(p.data.data),V(p.data.data),z(),A.success(p.data.message,{autoClose:1e3})}catch(g){if(W(g)){const p=(C=g.response)==null?void 0:C.data.data;p&&Object.keys(p).forEach(x=>{P(x,{message:p[x],type:"Server"})})}}}),L=f=>{a(f)};return s("div",{className:"rounded-sm bg-white px-4 pb-10 shadow md:px-7 md:pb-20",children:[s("div",{className:"sm: border-b border-b-gray-200 py-6 text-center md:text-left",children:[t("h1",{className:"text-lg font-medium capitalize text-gray-900",children:"Hồ sơ của tôi"}),t("div",{className:"mt-1 text-sm text-gray-700",children:"Quản lý thông tin hồ sơ để bảo mật tài khoản"})]}),t(X,{...i,children:s("form",{className:"mt-8 flex flex-col-reverse md:flex-row md:items-start",onSubmit:O,children:[s("div",{className:"mt-6 flex-grow md:mt-0 md:pr-12",children:[s("div",{className:" flex flex-wrap ",children:[t("div",{className:"truncate pr-5 pt-3 capitalize sm:w-[20%] sm:pr-0 sm:text-right",children:"Email:"}),t("div",{className:"w-[80%] sm:pl-5",children:t("div",{className:"pt-3 text-gray-700",children:m==null?void 0:m.email})})]}),t(Be,{}),s("div",{className:" mt-2 flex flex-col flex-wrap sm:flex-row",children:[t("div",{className:"w-full truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:"Địa chỉ:"}),t("div",{className:"mt-3 w-full sm:mt-0 sm:w-[80%] sm:pl-5",children:t(R,{classNameInput:`w-full rounded-sm border-[1px] border-gray-300 
              px-3 py-2 outline-none focus:border-gray-500 focus:shadow-sm`,placeholder:"Địa chỉ",name:"address",register:d,errorMessage:(I=h.address)==null?void 0:I.message})})]}),t(D,{control:b,name:"date_of_birth",render:({field:f})=>{var u;return t(Oe,{errorMessage:(u=h.date_of_birth)==null?void 0:u.message,onChange:f.onChange,value:f.value})}}),s("div",{className:" mt-2 flex flex-col flex-wrap md:flex-row",children:[t("div",{className:"w-full truncate pt-3 capitalize sm:w-[20%] sm:text-right"}),t("div",{className:"mt-3 flex w-full md:mt-0 md:w-[80%] md:justify-center md:pl-5",children:t("button",{className:`mt-3 flex h-12 w-full items-center justify-center rounded-sm 
                bg-orange px-5 capitalize text-white shadow-sm outline-none hover:bg-orange/90 md:w-[150px] `,type:"submit",children:"Lưu"})})]})]}),t("div",{className:"flex justify-center md:w-72 md:items-center md:border-l  md:border-l-gray-300 md:py-8",children:s("div",{className:"mb-6 flex flex-col items-center md:mb-0",children:[t("div",{className:"my-5 h-24 w-24",children:t("img",{src:n||Z(m==null?void 0:m.avatar),alt:"avatar",className:"h-full w-full rounded-full object-cover"})}),t(Le,{onChange:L}),s("div",{className:"mt-3 text-gray-400",children:[t("div",{children:"Dụng lượng file tối đa 1 MB"}),t("div",{children:"Định dạng:.JPEG, .PNG"})]})]})})]})})]})}export{Qe as default};
