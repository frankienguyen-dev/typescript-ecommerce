import{r as l,d as r,j as t,v as N,B as R,Q as S,A as U,a as G,o as L,b as _,i as T,D as Y,c as B,F as O,C as D,E as Q,G as q,H}from"./index-218255ac.js";import{u as y}from"./user.api-a7491ae7.js";import{I as M}from"./Input-0ce94ac9.js";import{I as J}from"./InputNumber-57f92840.js";function V({onChange:m,value:e,errorMessage:i}){const[o,s]=l.useState({date:(e==null?void 0:e.getDate())||1,month:(e==null?void 0:e.getMonth())||0,year:(e==null?void 0:e.getFullYear())||1990});l.useEffect(()=>{e&&s({date:e==null?void 0:e.getDate(),month:e==null?void 0:e.getMonth(),year:e==null?void 0:e.getFullYear()})},[e]);const d=a=>{const{name:c,value:w}=a.target,h={date:(e==null?void 0:e.getDate())||o.date,month:(e==null?void 0:e.getMonth())||o.month,year:(e==null?void 0:e.getFullYear())||o.year,[c]:Number(w)};s(h),m&&m(new Date(h.year,h.month,h.date))};return r("div",{className:" mt-2 flex flex-col flex-wrap sm:flex-row",children:[t("div",{className:"w-full truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:"Ngày sinh:"}),r("div",{className:"mt-3 w-full sm:mt-0 sm:w-[80%] sm:pl-5",children:[r("div",{className:"flex justify-between gap-5",children:[r("select",{onChange:d,value:(e==null?void 0:e.getDate())||o.date,name:"date",className:`h-10 w-[32%] rounded-sm border border-black/10 pl-2 hover:cursor-pointer
         hover:border-orange`,children:[t("option",{disabled:!0,children:"Ngày"}),N.range(1,32).map(a=>r("option",{value:a,children:["Ngày ",a]},a))]}),r("select",{onChange:d,value:(e==null?void 0:e.getMonth())||o.month,name:"month",className:`h-10 w-[32%] rounded-sm border border-black/10 pl-2 hover:cursor-pointer
         hover:border-orange`,children:[t("option",{disabled:!0,children:"Tháng"}),N.range(0,12).map(a=>r("option",{value:a,children:["Tháng ",a+1]},a))]}),r("select",{onChange:d,value:(e==null?void 0:e.getFullYear())||o.year,name:"year",className:`h-10 w-[32%] rounded-sm border border-black/10
         pl-2 hover:cursor-pointer hover:border-orange`,children:[t("option",{disabled:!0,children:"Năm"}),N.range(1990,2024).map(a=>r("option",{value:a,children:["Năm ",a]},a))]})]}),t("div",{className:"mt-1 min-h-[1.25rem] text-sm text-red-600",children:i})]})]})}function K({onChange:m}){const e=l.useRef(null),i=s=>{var a;const d=(a=s.target.files)==null?void 0:a[0];d&&(d.size>=R.maxSizeUploadAvatar||!d.type.includes("image"))&&S.error("Dụng lượng file tối đa 1 MB. Định dạng:.JPEG, .PNG",{autoClose:1e3}),m&&m(d)},o=()=>{var s;(s=e.current)==null||s.click()};return r(l.Fragment,{children:[t("input",{className:"hidden",type:"file",accept:".jpg,.jpeg,.png",ref:e,onChange:i,onClick:s=>{s.target.value=null}}),t("button",{className:`flex h-10 items-center justify-end rounded-sm border 
            bg-white px-6 text-sm text-gray-600 shadow-sm`,type:"button",onClick:o,children:"Chọn Ảnh"})]})}function W(){var o;const{register:m,formState:{errors:e},control:i}=q();return r(l.Fragment,{children:[r("div",{className:" mt-6 flex flex-col flex-wrap sm:flex-row",children:[t("div",{className:"w-full truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:"Tên:"}),t("div",{className:"mt-3 w-full sm:mt-0 sm:w-[80%] sm:pl-5",children:t(M,{classNameInput:`w-full rounded-sm border-[1px] border-gray-300 
              px-3 py-2 outline-none focus:border-gray-500 focus:shadow-sm`,placeholder:"Tên",name:"name",register:m,errorMessage:(o=e.name)==null?void 0:o.message})})]}),r("div",{className:" mt-2 flex flex-col flex-wrap sm:flex-row",children:[t("div",{className:"truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:"Số điện thoại:"}),t("div",{className:"mt-3 w-full sm:mt-0 sm:w-[80%] sm:pl-5",children:t(D,{control:i,name:"phone",render:({field:s})=>{var d;return t(J,{classNameInput:`w-full rounded-sm border-[1px] border-gray-300 
              px-3 py-2 outline-none focus:border-gray-500 focus:shadow-sm`,placeholder:"Số điện thoại",errorMessage:(d=e.phone)==null?void 0:d.message,...s,onChange:s.onChange})}})})]})]})}const X=H.pick(["name","avatar","phone","date_of_birth","address"]);function ae(){var C;const{setProfile:m}=l.useContext(U),[e,i]=l.useState(),o=l.useMemo(()=>e?URL.createObjectURL(e):"",[e]);l.useRef(null);const s=G({defaultValues:{name:"",phone:"",address:"",avatar:"",date_of_birth:new Date(1990,0,1)},resolver:L(X)}),{register:d,handleSubmit:a,setValue:c,control:w,formState:{errors:h},watch:j,setError:E}=s,I=j("avatar"),P=_(y.updateProfile),v=_(y.uploadAvatar),{data:b,refetch:z}=T({queryKey:["profiles"],queryFn:y.getProfile}),n=b==null?void 0:b.data.data;l.useEffect(()=>{n&&(c("name",n.name),c("phone",n.phone),c("address",n.address),c("avatar",n.avatar),c("date_of_birth",n.date_of_birth?new Date(n.date_of_birth):new Date(1990,0,1)))},[n,c]);const A=a(async f=>{var u,F;try{let g=I;if(e){const x=new FormData;x.append("image",e),g=(await v.mutateAsync(x)).data.data,c("avatar",g)}const p=await P.mutateAsync({...f,date_of_birth:(u=f.date_of_birth)==null?void 0:u.toISOString(),avatar:g});m(p.data.data),Y(p.data.data),z(),S.success(p.data.message,{autoClose:1e3})}catch(g){if(B(g)){const p=(F=g.response)==null?void 0:F.data.data;p&&Object.keys(p).forEach(x=>{E(x,{message:p[x],type:"Server"})})}}}),k=f=>{i(f)};return r("div",{className:"rounded-sm bg-white px-4 pb-10 shadow md:px-7 md:pb-20",children:[r("div",{className:"sm: border-b border-b-gray-200 py-6 text-center md:text-left",children:[t("h1",{className:"text-lg font-medium capitalize text-gray-900",children:"Hồ sơ của tôi"}),t("div",{className:"mt-1 text-sm text-gray-700",children:"Quản lý thông tin hồ sơ để bảo mật tài khoản"})]}),t(O,{...s,children:r("form",{className:"mt-8 flex flex-col-reverse md:flex-row md:items-start",onSubmit:A,children:[r("div",{className:"mt-6 flex-grow md:mt-0 md:pr-12",children:[r("div",{className:" flex flex-wrap ",children:[t("div",{className:"truncate pr-5 pt-3 capitalize sm:w-[20%] sm:pr-0 sm:text-right",children:"Email:"}),t("div",{className:"w-[80%] sm:pl-5",children:t("div",{className:"pt-3 text-gray-700",children:n==null?void 0:n.email})})]}),t(W,{}),r("div",{className:" mt-2 flex flex-col flex-wrap sm:flex-row",children:[t("div",{className:"w-full truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:"Địa chỉ:"}),t("div",{className:"mt-3 w-full sm:mt-0 sm:w-[80%] sm:pl-5",children:t(M,{classNameInput:`w-full rounded-sm border-[1px] border-gray-300 
              px-3 py-2 outline-none focus:border-gray-500 focus:shadow-sm`,placeholder:"Địa chỉ",name:"address",register:d,errorMessage:(C=h.address)==null?void 0:C.message})})]}),t(D,{control:w,name:"date_of_birth",render:({field:f})=>{var u;return t(V,{errorMessage:(u=h.date_of_birth)==null?void 0:u.message,onChange:f.onChange,value:f.value})}}),r("div",{className:" mt-2 flex flex-col flex-wrap md:flex-row",children:[t("div",{className:"w-full truncate pt-3 capitalize sm:w-[20%] sm:text-right"}),t("div",{className:"mt-3 flex w-full md:mt-0 md:w-[80%] md:justify-center md:pl-5",children:t("button",{className:`mt-3 flex h-12 w-full items-center justify-center rounded-sm 
                bg-orange px-5 capitalize text-white shadow-sm outline-none hover:bg-orange/90 md:w-[150px] `,type:"submit",children:"Lưu"})})]})]}),t("div",{className:"flex justify-center md:w-72 md:items-center md:border-l  md:border-l-gray-300 md:py-8",children:r("div",{className:"mb-6 flex flex-col items-center md:mb-0",children:[t("div",{className:"my-5 h-24 w-24",children:t("img",{src:o||Q(n==null?void 0:n.avatar),alt:"avatar",className:"h-full w-full rounded-full object-cover"})}),t(K,{onChange:k}),r("div",{className:"mt-3 text-gray-400",children:[t("div",{children:"Dụng lượng file tối đa 1 MB"}),t("div",{children:"Định dạng:.JPEG, .PNG"})]})]})})]})})]})}export{ae as default};
