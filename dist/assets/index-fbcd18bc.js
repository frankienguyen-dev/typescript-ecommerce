import{r as S,A as _e,i as Ae,b as U,I as Se,v as Ce,j as a,d,L as X,p as G,z as me,l as M,n as he,q as Q,Q as pe}from"./index-218255ac.js";import{B as De}from"./Button-5d55b0d0.js";import{Q as Me}from"./QuantityController-9cb15475.js";import"./InputNumber-57f92840.js";function b(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw Error("[Immer] minified error nr: "+e+(n.length?" "+n.map(function(c){return"'"+c+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function C(e){return!!e&&!!e[y]}function O(e){var t;return!!e&&(function(n){if(!n||typeof n!="object")return!1;var r=Object.getPrototypeOf(n);if(r===null)return!0;var c=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return c===Object||typeof c=="function"&&Function.toString.call(c)===qe}(e)||Array.isArray(e)||!!e[we]||!!(!((t=e.constructor)===null||t===void 0)&&t[we])||ie(e)||oe(e))}function E(e,t,n){n===void 0&&(n=!1),D(e)===0?(n?Object.keys:de)(e).forEach(function(r){n&&typeof r=="symbol"||t(r,e[r],e)}):e.forEach(function(r,c){return t(c,r,e)})}function D(e){var t=e[y];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:ie(e)?2:oe(e)?3:0}function ee(e,t){return D(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Fe(e,t){return D(e)===2?e.get(t):e[t]}function je(e,t,n){var r=D(e);r===2?e.set(t,n):r===3?e.add(n):e[t]=n}function Ee(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function ie(e){return Qe&&e instanceof Map}function oe(e){return $e&&e instanceof Set}function j(e){return e.o||e.t}function ae(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=Ke(e);delete t[y];for(var n=de(t),r=0;r<n.length;r++){var c=n[r],o=t[c];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(t[c]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[c]})}return Object.create(Object.getPrototypeOf(e),t)}function se(e,t){return t===void 0&&(t=!1),ue(e)||C(e)||!O(e)||(D(e)>1&&(e.set=e.add=e.clear=e.delete=Re),Object.freeze(e),t&&E(e,function(n,r){return se(r,!0)},!0)),e}function Re(){b(2)}function ue(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function N(e){var t=Le[e];return t||b(18,e),t}function ye(){return R}function H(e,t){t&&(N("Patches"),e.u=[],e.s=[],e.v=t)}function $(e){te(e),e.p.forEach(ze),e.p=null}function te(e){e===R&&(R=e.l)}function ve(e){return R={p:[],l:R,h:e,m:!0,_:0}}function ze(e){var t=e[y];t.i===0||t.i===1?t.j():t.g=!0}function J(e,t){t._=t.p.length;var n=t.p[0],r=e!==void 0&&e!==n;return t.h.O||N("ES5").S(t,e,r),r?(n[y].P&&($(t),b(4)),O(e)&&(e=q(t,e),t.l||K(t,e)),t.u&&N("Patches").M(n[y].t,e,t.u,t.s)):e=q(t,n,[]),$(t),t.u&&t.v(t.u,t.s),e!==Oe?e:void 0}function q(e,t,n){if(ue(t))return t;var r=t[y];if(!r)return E(t,function(l,h){return ge(e,r,t,l,h,n)},!0),t;if(r.A!==e)return t;if(!r.P)return K(e,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var c=r.i===4||r.i===5?r.o=ae(r.k):r.o,o=c,u=!1;r.i===3&&(o=new Set(c),c.clear(),u=!0),E(o,function(l,h){return ge(e,r,c,l,h,n,u)}),K(e,c,!1),n&&e.u&&N("Patches").N(r,n,e.u,e.s)}return r.o}function ge(e,t,n,r,c,o,u){if(C(c)){var l=q(e,c,o&&t&&t.i!==3&&!ee(t.R,r)?o.concat(r):void 0);if(je(n,r,l),!C(l))return;e.m=!1}else u&&n.add(c);if(O(c)&&!ue(c)){if(!e.h.D&&e._<1)return;q(e,c),t&&t.A.l||K(e,c)}}function K(e,t,n){n===void 0&&(n=!1),!e.l&&e.h.D&&e.m&&se(t,n)}function Y(e,t){var n=e[y];return(n?j(n):e)[t]}function be(e,t){if(t in e)for(var n=Object.getPrototypeOf(e);n;){var r=Object.getOwnPropertyDescriptor(n,t);if(r)return r;n=Object.getPrototypeOf(n)}}function ne(e){e.P||(e.P=!0,e.l&&ne(e.l))}function Z(e){e.o||(e.o=ae(e.t))}function re(e,t,n){var r=ie(t)?N("MapSet").F(t,n):oe(t)?N("MapSet").T(t,n):e.O?function(c,o){var u=Array.isArray(c),l={i:u?1:0,A:o?o.A:ye(),P:!1,I:!1,R:{},l:o,t:c,k:null,o:null,j:null,C:!1},h=l,f=ce;u&&(h=[l],f=F);var m=Proxy.revocable(h,f),P=m.revoke,g=m.proxy;return l.k=g,l.j=P,g}(t,n):N("ES5").J(t,n);return(n?n.A:ye()).p.push(r),r}function Ie(e){return C(e)||b(22,e),function t(n){if(!O(n))return n;var r,c=n[y],o=D(n);if(c){if(!c.P&&(c.i<4||!N("ES5").K(c)))return c.t;c.I=!0,r=xe(n,o),c.I=!1}else r=xe(n,o);return E(r,function(u,l){c&&Fe(c.t,u)===l||je(r,u,t(l))}),o===3?new Set(r):r}(e)}function xe(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return ae(e)}var Ne,R,le=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Qe=typeof Map<"u",$e=typeof Set<"u",Pe=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Oe=le?Symbol.for("immer-nothing"):((Ne={})["immer-nothing"]=!0,Ne),we=le?Symbol.for("immer-draftable"):"__$immer_draftable",y=le?Symbol.for("immer-state"):"__$immer_state",qe=""+Object.prototype.constructor,de=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,Ke=Object.getOwnPropertyDescriptors||function(e){var t={};return de(e).forEach(function(n){t[n]=Object.getOwnPropertyDescriptor(e,n)}),t},Le={},ce={get:function(e,t){if(t===y)return e;var n=j(e);if(!ee(n,t))return function(c,o,u){var l,h=be(o,u);return h?"value"in h?h.value:(l=h.get)===null||l===void 0?void 0:l.call(c.k):void 0}(e,n,t);var r=n[t];return e.I||!O(r)?r:r===Y(e.t,t)?(Z(e),e.o[t]=re(e.A.h,r,e)):r},has:function(e,t){return t in j(e)},ownKeys:function(e){return Reflect.ownKeys(j(e))},set:function(e,t,n){var r=be(j(e),t);if(r!=null&&r.set)return r.set.call(e.k,n),!0;if(!e.P){var c=Y(j(e),t),o=c==null?void 0:c[y];if(o&&o.t===n)return e.o[t]=n,e.R[t]=!1,!0;if(Ee(n,c)&&(n!==void 0||ee(e.t,t)))return!0;Z(e),ne(e)}return e.o[t]===n&&(n!==void 0||t in e.o)||Number.isNaN(n)&&Number.isNaN(e.o[t])||(e.o[t]=n,e.R[t]=!0),!0},deleteProperty:function(e,t){return Y(e.t,t)!==void 0||t in e.t?(e.R[t]=!1,Z(e),ne(e)):delete e.R[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var n=j(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:r.enumerable,value:n[t]}},defineProperty:function(){b(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){b(12)}},F={};E(ce,function(e,t){F[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),F.deleteProperty=function(e,t){return F.set.call(this,e,t,void 0)},F.set=function(e,t,n){return ce.set.call(this,e[0],t,n,e[0])};var Be=function(){function e(n){var r=this;this.O=Pe,this.D=!0,this.produce=function(c,o,u){if(typeof c=="function"&&typeof o!="function"){var l=o;o=c;var h=r;return function(x){var B=this;x===void 0&&(x=l);for(var w=arguments.length,_=Array(w>1?w-1:0),A=1;A<w;A++)_[A-1]=arguments[A];return h.produce(x,function(T){var z;return(z=o).call.apply(z,[B,T].concat(_))})}}var f;if(typeof o!="function"&&b(6),u!==void 0&&typeof u!="function"&&b(7),O(c)){var m=ve(r),P=re(r,c,void 0),g=!0;try{f=o(P),g=!1}finally{g?$(m):te(m)}return typeof Promise<"u"&&f instanceof Promise?f.then(function(x){return H(m,u),J(x,m)},function(x){throw $(m),x}):(H(m,u),J(f,m))}if(!c||typeof c!="object"){if((f=o(c))===void 0&&(f=c),f===Oe&&(f=void 0),r.D&&se(f,!0),u){var k=[],L=[];N("Patches").M(c,f,k,L),u(k,L)}return f}b(21,c)},this.produceWithPatches=function(c,o){if(typeof c=="function")return function(f){for(var m=arguments.length,P=Array(m>1?m-1:0),g=1;g<m;g++)P[g-1]=arguments[g];return r.produceWithPatches(f,function(k){return c.apply(void 0,[k].concat(P))})};var u,l,h=r.produce(c,o,function(f,m){u=f,l=m});return typeof Promise<"u"&&h instanceof Promise?h.then(function(f){return[f,u,l]}):[h,u,l]},typeof(n==null?void 0:n.useProxies)=="boolean"&&this.setUseProxies(n.useProxies),typeof(n==null?void 0:n.autoFreeze)=="boolean"&&this.setAutoFreeze(n.autoFreeze)}var t=e.prototype;return t.createDraft=function(n){O(n)||b(8),C(n)&&(n=Ie(n));var r=ve(this),c=re(this,n,void 0);return c[y].C=!0,te(r),c},t.finishDraft=function(n,r){var c=n&&n[y],o=c.A;return H(o,r),J(void 0,o)},t.setAutoFreeze=function(n){this.D=n},t.setUseProxies=function(n){n&&!Pe&&b(20),this.O=n},t.applyPatches=function(n,r){var c;for(c=r.length-1;c>=0;c--){var o=r[c];if(o.path.length===0&&o.op==="replace"){n=o.value;break}}c>-1&&(r=r.slice(c+1));var u=N("Patches").$;return C(n)?u(n,r):this.produce(n,function(l){return u(l,r)})},e}(),v=new Be,Te=v.produce;v.produceWithPatches.bind(v);v.setAutoFreeze.bind(v);v.setUseProxies.bind(v);v.applyPatches.bind(v);v.createDraft.bind(v);v.finishDraft.bind(v);const V=Te;function He(){var fe;const{isAuthenticated:e,extendedPurchase:t,setExtendedPurchase:n}=S.useContext(_e),{data:r,refetch:c}=Ae({queryKey:["purchases",{status:he.inCart}],queryFn:()=>Q.getPurchase({status:he.inCart}),enabled:e}),o=U({mutationFn:Q.updatePurchase,onSuccess:()=>{c()}}),u=U({mutationFn:Q.buyProduct,onSuccess:i=>{c(),pe.success(i.data.message,{autoClose:1e3})}}),l=U({mutationFn:Q.deletePurchase,onSuccess:i=>{c(),pe.success(i.data.message,{autoClose:1e3})}}),h=r==null?void 0:r.data.data,f=S.useMemo(()=>t.every(i=>i.checked),[t]),m=S.useMemo(()=>t.filter(i=>i.checked),[t]),P=m.length,g=S.useMemo(()=>m.reduce((i,s)=>(i+s.product.price)*s.buy_count,0),[m]),k=m.reduce((i,s)=>(i+s.product.price_before_discount-s.product.price)*s.buy_count,0),x=(fe=Se().state)==null?void 0:fe.purchaseId;S.useEffect(()=>{n(i=>{const s=Ce.keyBy(i,"_id");return(h==null?void 0:h.map(p=>{var I;const W=x===p._id;return{...p,disabled:!1,checked:W||Boolean((I=s[p._id])==null?void 0:I.checked)}}))||[]})},[h,x]),S.useEffect(()=>()=>{history.replaceState(null,"")});const B=i=>s=>{n(V(p=>{p[i].checked=s.target.checked}))},w=()=>{n(i=>i.map(s=>({...s,checked:!f})))},_=(i,s,p)=>{if(p){const W=t[i];n(V(I=>{I[i].disabled=!0})),o.mutate({product_id:W.product._id,buy_count:s})}},A=i=>s=>{n(V(p=>{p[i].buy_count=s}))},T=i=>()=>{const s=t[i]._id;l.mutate([s])},z=()=>{const i=m.map(s=>s._id);l.mutate(i)},ke=()=>{if(m.length>0){const i=m.map(s=>({product_id:s.product._id,buy_count:s.buy_count}));u.mutate(i)}};return a("div",{className:"bg-neutral-100 py-16",children:d("div",{className:"container",children:[t.length>0&&d("div",{children:[a("div",{className:"overflow-auto",children:d("div",{className:"min-w-[1000px]",children:[d("div",{className:"grid grid-cols-12 rounded-sm bg-white py-5 px-9 text-sm capitalize text-gray-500 shadow ",children:[a("div",{className:"col-span-6",children:d("div",{className:"flex items-center",children:[a("div",{className:"flex flex-shrink-0 items-center justify-center pr-3",children:a("input",{type:"checkbox",className:"h-4 w-4 accent-orange",checked:f,onChange:w})}),a("div",{className:"flex-grow text-black",children:"Sản phẩm "})]})}),a("div",{className:"col-span-6",children:d("div",{className:"grid grid-cols-5 text-center",children:[a("div",{className:"col-span-2",children:"Đơn giá"}),a("div",{className:"col-span-1",children:"Số lượng"}),a("div",{className:"col-span-1",children:"Số tiền"}),a("div",{className:"col-span-1",children:"Thao tác"})]})})]}),t.length>0&&a("div",{className:"my-3 rounded-sm bg-white p-5 shadow",children:t==null?void 0:t.map((i,s)=>d("div",{className:`mt-5 grid grid-cols-12 items-center rounded-sm border border-gray-200
                   bg-white py-5 px-4 text-center text-sm capitalize text-gray-500 shadow first:mt-0 `,children:[a("div",{className:"col-span-6",children:d("div",{className:"flex",children:[a("div",{className:"flex flex-shrink-0 items-center justify-center pr-3",children:a("input",{type:"checkbox",className:"h-4 w-4 accent-orange",checked:i.checked,onChange:B(s)})}),a("div",{className:"flex-grow",children:d("div",{className:"flex",children:[a(X,{to:`${G.home}${me({name:i.product.name,id:i.product._id})}`,className:"h-20 w-20 flex-shrink-0",children:a("img",{src:i.product.image,alt:i.product.name})}),a("div",{className:"flex-grow px-2 pt-1 pb-2",children:a(X,{className:"text-left line-clamp-2",to:`${G.home}${me({name:i.product.name,id:i.product._id})}`,children:i.product.name})})]})})]})}),a("div",{className:"col-span-6",children:d("div",{className:" grid grid-cols-5 items-center justify-center",children:[a("div",{className:"col-span-2",children:d("div",{className:"flex items-center justify-center",children:[d("span",{className:"text-gray-450 line-through",children:["₫",M(i.product.price_before_discount)]}),d("span",{className:"ml-3 ",children:["₫",M(i.product.price)]})]})}),a("div",{className:"col-span-1",children:a(Me,{max:i.product.quantity,value:i.buy_count,classNameWrapper:"flex items-center",onIncrease:p=>_(s,p,p<=i.product.quantity),onDecrease:p=>_(s,p,p>=1),onType:A(s),onFocusOut:p=>_(s,p,p>=1&&p<=i.product.quantity&&p!==h[s].buy_count),disabled:i.disabled})}),a("div",{className:"col-span-1",children:a("div",{className:"flex items-center justify-center",children:d("span",{className:"text-orange",children:["₫",M(i.product.price*i.buy_count)]})})}),a("div",{className:"col-span-1",children:a("div",{className:"flex items-center justify-center",children:a("button",{onClick:T(s),className:"bg-none text-black transition-colors hover:text-orange",children:"Xoá"})})})]})})]},i._id))})]})}),d("div",{className:`sticky bottom-0 z-10 mt-10 flex flex-col  rounded-sm border border-gray-200 bg-white p-5
         shadow sm:flex-row sm:items-center`,children:[d("div",{className:"flex items-center justify-center sm:justify-start",children:[a("div",{className:"flex flex-shrink-0 items-center justify-center pr-3",children:a("input",{type:"checkbox",className:"h-4 w-4 accent-orange",checked:f,onChange:w})}),d("button",{onClick:w,className:"mx-3 border-none bg-none",children:["Chọn tất cả (",t.length,")"]}),a("button",{onClick:z,className:"mx-3 border-none bg-none",children:"Xoá"})]}),d("div",{className:"mt-5 flex flex-col items-center justify-center sm:ml-auto sm:mt-0 sm:flex-row",children:[d("div",{children:[d("div",{className:"flex items-center justify-center sm:flex-row sm:justify-end",children:[d("div",{children:["Tổng thanh toán (",P," sản phẩm):"]}),d("div",{className:"ml-2 text-2xl text-orange",children:["₫",M(g)]})]}),d("div",{className:"flex items-center justify-center text-sm sm:justify-end",children:[a("div",{className:"text-gray-500",children:"Tiết kiệm:"}),d("div",{className:"ml-6 text-orange",children:["₫",M(k)]})]})]}),a(De,{onClick:ke,disabled:u.isLoading,className:`ml-4 mt-5 flex h-10 w-44 items-center justify-center 
              bg-orange text-sm uppercase text-white hover:bg-orange/80 sm:mt-0`,children:"Mua hàng"})]})]})]}),!(t.length>0)&&d("div",{className:"py-20",children:[a("div",{className:" flex items-center justify-center pt-10",children:a("img",{className:"h-36 w-36",src:"src/images/no-product.png",alt:"no purchases"})}),a("div",{className:"flex items-center justify-center",children:a("span",{className:"",children:"Giỏ hàng của bạn còn trống"})}),a("div",{className:"flex items-center justify-center",children:a(X,{to:G.home,className:"mt-5 flex h-10 w-44 items-center justify-center bg-orange text-sm uppercase text-white hover:bg-orange/80",children:"MUA NGAY"})})]})]})})}export{He as default};
