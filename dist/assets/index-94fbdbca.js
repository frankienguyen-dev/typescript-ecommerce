import{N as _e,D as Ae,O as Se,P as Fe,R as Ce,r as S,A as Ee,i as De,b as U,S as Me,j as s,d as f,L as X,p as G,z as he,l as E,n as me,q as R,Q as pe}from"./index-00ae5234.js";import{B as $e}from"./Button-acad5a79.js";import{Q as Be}from"./QuantityController-75cf8fe2.js";import"./InputNumber-bdf05a35.js";function b(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(a){return"'"+a+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function F(e){return!!e&&!!e[v]}function O(e){var t;return!!e&&(function(r){if(!r||typeof r!="object")return!1;var n=Object.getPrototypeOf(r);if(n===null)return!0;var a=Object.hasOwnProperty.call(n,"constructor")&&n.constructor;return a===Object||typeof a=="function"&&Function.toString.call(a)===Te}(e)||Array.isArray(e)||!!e[we]||!!(!((t=e.constructor)===null||t===void 0)&&t[we])||ce(e)||ie(e))}function M(e,t,r){r===void 0&&(r=!1),C(e)===0?(r?Object.keys:de)(e).forEach(function(n){r&&typeof n=="symbol"||t(n,e[n],e)}):e.forEach(function(n,a){return t(a,n,e)})}function C(e){var t=e[v];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:ce(e)?2:ie(e)?3:0}function ee(e,t){return C(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Ie(e,t){return C(e)===2?e.get(t):e[t]}function ke(e,t,r){var n=C(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function Re(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function ce(e){return qe&&e instanceof Map}function ie(e){return Ke&&e instanceof Set}function k(e){return e.o||e.t}function oe(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=We(e);delete t[v];for(var r=de(t),n=0;n<r.length;n++){var a=r[n],c=t[a];c.writable===!1&&(c.writable=!0,c.configurable=!0),(c.get||c.set)&&(t[a]={configurable:!0,writable:!0,enumerable:c.enumerable,value:e[a]})}return Object.create(Object.getPrototypeOf(e),t)}function se(e,t){return t===void 0&&(t=!1),ue(e)||F(e)||!O(e)||(C(e)>1&&(e.set=e.add=e.clear=e.delete=ze),Object.freeze(e),t&&M(e,function(r,n){return se(n,!0)},!0)),e}function ze(){b(2)}function ue(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function N(e){var t=Ue[e];return t||b(18,e),t}function ve(){return $}function V(e,t){t&&(N("Patches"),e.u=[],e.s=[],e.v=t)}function z(e){te(e),e.p.forEach(Le),e.p=null}function te(e){e===$&&($=e.l)}function ye(e){return $={p:[],l:$,h:e,m:!0,_:0}}function Le(e){var t=e[v];t.i===0||t.i===1?t.j():t.g=!0}function H(e,t){t._=t.p.length;var r=t.p[0],n=e!==void 0&&e!==r;return t.h.O||N("ES5").S(t,e,n),n?(r[v].P&&(z(t),b(4)),O(e)&&(e=L(t,e),t.l||Q(t,e)),t.u&&N("Patches").M(r[v].t,e,t.u,t.s)):e=L(t,r,[]),z(t),t.u&&t.v(t.u,t.s),e!==Oe?e:void 0}function L(e,t,r){if(ue(t))return t;var n=t[v];if(!n)return M(t,function(u,d){return ge(e,n,t,u,d,r)},!0),t;if(n.A!==e)return t;if(!n.P)return Q(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var a=n.i===4||n.i===5?n.o=oe(n.k):n.o,c=a,o=!1;n.i===3&&(c=new Set(a),a.clear(),o=!0),M(c,function(u,d){return ge(e,n,a,u,d,r,o)}),Q(e,a,!1),r&&e.u&&N("Patches").N(n,r,e.u,e.s)}return n.o}function ge(e,t,r,n,a,c,o){if(F(a)){var u=L(e,a,c&&t&&t.i!==3&&!ee(t.R,n)?c.concat(n):void 0);if(ke(r,n,u),!F(u))return;e.m=!1}else o&&r.add(a);if(O(a)&&!ue(a)){if(!e.h.D&&e._<1)return;L(e,a),t&&t.A.l||Q(e,a)}}function Q(e,t,r){r===void 0&&(r=!1),!e.l&&e.h.D&&e.m&&se(t,r)}function J(e,t){var r=e[v];return(r?k(r):e)[t]}function be(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function re(e){e.P||(e.P=!0,e.l&&re(e.l))}function Y(e){e.o||(e.o=oe(e.t))}function ne(e,t,r){var n=ce(t)?N("MapSet").F(t,r):ie(t)?N("MapSet").T(t,r):e.O?function(a,c){var o=Array.isArray(a),u={i:o?1:0,A:c?c.A:ve(),P:!1,I:!1,R:{},l:c,t:a,k:null,o:null,j:null,C:!1},d=u,h=ae;o&&(d=[u],h=D);var m=Proxy.revocable(d,h),P=m.revoke,g=m.proxy;return u.k=g,u.j=P,g}(t,r):N("ES5").J(t,r);return(r?r.A:ve()).p.push(n),n}function Qe(e){return F(e)||b(22,e),function t(r){if(!O(r))return r;var n,a=r[v],c=C(r);if(a){if(!a.P&&(a.i<4||!N("ES5").K(a)))return a.t;a.I=!0,n=xe(r,c),a.I=!1}else n=xe(r,c);return M(n,function(o,u){a&&Ie(a.t,o)===u||ke(n,o,t(u))}),c===3?new Set(n):n}(e)}function xe(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return oe(e)}var Ne,$,le=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",qe=typeof Map<"u",Ke=typeof Set<"u",Pe=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Oe=le?Symbol.for("immer-nothing"):((Ne={})["immer-nothing"]=!0,Ne),we=le?Symbol.for("immer-draftable"):"__$immer_draftable",v=le?Symbol.for("immer-state"):"__$immer_state",Te=""+Object.prototype.constructor,de=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,We=Object.getOwnPropertyDescriptors||function(e){var t={};return de(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},Ue={},ae={get:function(e,t){if(t===v)return e;var r=k(e);if(!ee(r,t))return function(a,c,o){var u,d=be(c,o);return d?"value"in d?d.value:(u=d.get)===null||u===void 0?void 0:u.call(a.k):void 0}(e,r,t);var n=r[t];return e.I||!O(n)?n:n===J(e.t,t)?(Y(e),e.o[t]=ne(e.A.h,n,e)):n},has:function(e,t){return t in k(e)},ownKeys:function(e){return Reflect.ownKeys(k(e))},set:function(e,t,r){var n=be(k(e),t);if(n!=null&&n.set)return n.set.call(e.k,r),!0;if(!e.P){var a=J(k(e),t),c=a==null?void 0:a[v];if(c&&c.t===r)return e.o[t]=r,e.R[t]=!1,!0;if(Re(r,a)&&(r!==void 0||ee(e.t,t)))return!0;Y(e),re(e)}return e.o[t]===r&&(r!==void 0||t in e.o)||Number.isNaN(r)&&Number.isNaN(e.o[t])||(e.o[t]=r,e.R[t]=!0),!0},deleteProperty:function(e,t){return J(e.t,t)!==void 0||t in e.t?(e.R[t]=!1,Y(e),re(e)):delete e.R[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=k(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty:function(){b(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){b(12)}},D={};M(ae,function(e,t){D[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),D.deleteProperty=function(e,t){return D.set.call(this,e,t,void 0)},D.set=function(e,t,r){return ae.set.call(this,e[0],t,r,e[0])};var Xe=function(){function e(r){var n=this;this.O=Pe,this.D=!0,this.produce=function(a,c,o){if(typeof a=="function"&&typeof c!="function"){var u=c;c=a;var d=n;return function(x){var K=this;x===void 0&&(x=u);for(var w=arguments.length,_=Array(w>1?w-1:0),A=1;A<w;A++)_[A-1]=arguments[A];return d.produce(x,function(T){var B;return(B=c).call.apply(B,[K,T].concat(_))})}}var h;if(typeof c!="function"&&b(6),o!==void 0&&typeof o!="function"&&b(7),O(a)){var m=ye(n),P=ne(n,a,void 0),g=!0;try{h=c(P),g=!1}finally{g?z(m):te(m)}return typeof Promise<"u"&&h instanceof Promise?h.then(function(x){return V(m,o),H(x,m)},function(x){throw z(m),x}):(V(m,o),H(h,m))}if(!a||typeof a!="object"){if((h=c(a))===void 0&&(h=a),h===Oe&&(h=void 0),n.D&&se(h,!0),o){var j=[],q=[];N("Patches").M(a,h,j,q),o(j,q)}return h}b(21,a)},this.produceWithPatches=function(a,c){if(typeof a=="function")return function(h){for(var m=arguments.length,P=Array(m>1?m-1:0),g=1;g<m;g++)P[g-1]=arguments[g];return n.produceWithPatches(h,function(j){return a.apply(void 0,[j].concat(P))})};var o,u,d=n.produce(a,c,function(h,m){o=h,u=m});return typeof Promise<"u"&&d instanceof Promise?d.then(function(h){return[h,o,u]}):[d,o,u]},typeof(r==null?void 0:r.useProxies)=="boolean"&&this.setUseProxies(r.useProxies),typeof(r==null?void 0:r.autoFreeze)=="boolean"&&this.setAutoFreeze(r.autoFreeze)}var t=e.prototype;return t.createDraft=function(r){O(r)||b(8),F(r)&&(r=Qe(r));var n=ye(this),a=ne(this,r,void 0);return a[v].C=!0,te(n),a},t.finishDraft=function(r,n){var a=r&&r[v],c=a.A;return V(c,n),H(void 0,c)},t.setAutoFreeze=function(r){this.D=r},t.setUseProxies=function(r){r&&!Pe&&b(20),this.O=r},t.applyPatches=function(r,n){var a;for(a=n.length-1;a>=0;a--){var c=n[a];if(c.path.length===0&&c.op==="replace"){r=c.value;break}}a>-1&&(n=n.slice(a+1));var o=N("Patches").$;return F(r)?o(r,n):this.produce(r,function(u){return o(u,n)})},e}(),y=new Xe,Ge=y.produce;y.produceWithPatches.bind(y);y.setAutoFreeze.bind(y);y.setUseProxies.bind(y);y.applyPatches.bind(y);y.createDraft.bind(y);y.finishDraft.bind(y);const Z=Ge;function Ve(e,t,r,n){for(var a=-1,c=e==null?0:e.length;++a<c;){var o=e[a];t(n,o,r(o),e)}return n}var He=Ve;function Je(e){return function(t,r,n){for(var a=-1,c=Object(t),o=n(t),u=o.length;u--;){var d=o[e?u:++a];if(r(c[d],d,c)===!1)break}return t}}var Ye=Je,Ze=Ye,et=Ze(),tt=et,rt=tt,nt=_e;function at(e,t){return e&&rt(e,t,nt)}var ct=at,it=Ae;function ot(e,t){return function(r,n){if(r==null)return r;if(!it(r))return e(r,n);for(var a=r.length,c=t?a:-1,o=Object(r);(t?c--:++c<a)&&n(o[c],c,o)!==!1;);return r}}var st=ot,ut=ct,lt=st,dt=lt(ut),ft=dt,ht=ft;function mt(e,t,r,n){return ht(e,function(a,c,o){t(n,a,r(a),o)}),n}var pt=mt,vt=He,yt=pt,gt=Se,bt=Fe;function xt(e,t){return function(r,n){var a=bt(r)?vt:yt,c=t?t():{};return a(r,e,gt(n),c)}}var Nt=xt,Pt=Ce,wt=Nt,kt=wt(function(e,t,r){Pt(e,r,t)}),Ot=kt;const jt=Ot;function Ct(){var fe;const{isAuthenticated:e,extendedPurchase:t,setExtendedPurchase:r}=S.useContext(Ee),{data:n,refetch:a}=De({queryKey:["purchases",{status:me.inCart}],queryFn:()=>R.getPurchase({status:me.inCart}),enabled:e}),c=U({mutationFn:R.updatePurchase,onSuccess:()=>{a()}}),o=U({mutationFn:R.buyProduct,onSuccess:i=>{a(),pe.success(i.data.message,{autoClose:1e3})}}),u=U({mutationFn:R.deletePurchase,onSuccess:i=>{a(),pe.success(i.data.message,{autoClose:1e3})}}),d=n==null?void 0:n.data.data,h=S.useMemo(()=>t.every(i=>i.checked),[t]),m=S.useMemo(()=>t.filter(i=>i.checked),[t]),P=m.length,g=S.useMemo(()=>m.reduce((i,l)=>(i+l.product.price)*l.buy_count,0),[m]),j=m.reduce((i,l)=>(i+l.product.price_before_discount-l.product.price)*l.buy_count,0),x=(fe=Me().state)==null?void 0:fe.purchaseId;S.useEffect(()=>{r(i=>{const l=jt(i,"_id");return(d==null?void 0:d.map(p=>{var I;const W=x===p._id;return{...p,disabled:!1,checked:W||Boolean((I=l[p._id])==null?void 0:I.checked)}}))||[]})},[d,x]),S.useEffect(()=>()=>{history.replaceState(null,"")});const K=i=>l=>{r(Z(p=>{p[i].checked=l.target.checked}))},w=()=>{r(i=>i.map(l=>({...l,checked:!h})))},_=(i,l,p)=>{if(p){const W=t[i];r(Z(I=>{I[i].disabled=!0})),c.mutate({product_id:W.product._id,buy_count:l})}},A=i=>l=>{r(Z(p=>{p[i].buy_count=l}))},T=i=>()=>{const l=t[i]._id;u.mutate([l])},B=()=>{const i=m.map(l=>l._id);u.mutate(i)},je=()=>{if(m.length>0){const i=m.map(l=>({product_id:l.product._id,buy_count:l.buy_count}));o.mutate(i)}};return s("div",{className:"bg-neutral-100 py-16",children:f("div",{className:"container",children:[t.length>0&&f("div",{children:[s("div",{className:"overflow-auto",children:f("div",{className:"min-w-[1000px]",children:[f("div",{className:"grid grid-cols-12 rounded-sm bg-white py-5 px-9 text-sm capitalize text-gray-500 shadow ",children:[s("div",{className:"col-span-6",children:f("div",{className:"flex items-center",children:[s("div",{className:"flex flex-shrink-0 items-center justify-center pr-3",children:s("input",{type:"checkbox",className:"h-4 w-4 accent-orange",checked:h,onChange:w})}),s("div",{className:"flex-grow text-black",children:"Sản phẩm "})]})}),s("div",{className:"col-span-6",children:f("div",{className:"grid grid-cols-5 text-center",children:[s("div",{className:"col-span-2",children:"Đơn giá"}),s("div",{className:"col-span-1",children:"Số lượng"}),s("div",{className:"col-span-1",children:"Số tiền"}),s("div",{className:"col-span-1",children:"Thao tác"})]})})]}),t.length>0&&s("div",{className:"my-3 rounded-sm bg-white p-5 shadow",children:t==null?void 0:t.map((i,l)=>f("div",{className:`mt-5 grid grid-cols-12 items-center rounded-sm border border-gray-200
                   bg-white py-5 px-4 text-center text-sm capitalize text-gray-500 shadow first:mt-0 `,children:[s("div",{className:"col-span-6",children:f("div",{className:"flex",children:[s("div",{className:"flex flex-shrink-0 items-center justify-center pr-3",children:s("input",{type:"checkbox",className:"h-4 w-4 accent-orange",checked:i.checked,onChange:K(l)})}),s("div",{className:"flex-grow",children:f("div",{className:"flex",children:[s(X,{to:`${G.home}${he({name:i.product.name,id:i.product._id})}`,className:"h-20 w-20 flex-shrink-0",children:s("img",{src:i.product.image,alt:i.product.name})}),s("div",{className:"flex-grow px-2 pt-1 pb-2",children:s(X,{className:"text-left line-clamp-2",to:`${G.home}${he({name:i.product.name,id:i.product._id})}`,children:i.product.name})})]})})]})}),s("div",{className:"col-span-6",children:f("div",{className:" grid grid-cols-5 items-center justify-center",children:[s("div",{className:"col-span-2",children:f("div",{className:"flex items-center justify-center",children:[f("span",{className:"text-gray-450 line-through",children:["₫",E(i.product.price_before_discount)]}),f("span",{className:"ml-3 ",children:["₫",E(i.product.price)]})]})}),s("div",{className:"col-span-1",children:s(Be,{max:i.product.quantity,value:i.buy_count,classNameWrapper:"flex items-center",onIncrease:p=>_(l,p,p<=i.product.quantity),onDecrease:p=>_(l,p,p>=1),onType:A(l),onFocusOut:p=>_(l,p,p>=1&&p<=i.product.quantity&&p!==d[l].buy_count),disabled:i.disabled})}),s("div",{className:"col-span-1",children:s("div",{className:"flex items-center justify-center",children:f("span",{className:"text-orange",children:["₫",E(i.product.price*i.buy_count)]})})}),s("div",{className:"col-span-1",children:s("div",{className:"flex items-center justify-center",children:s("button",{onClick:T(l),className:"bg-none text-black transition-colors hover:text-orange",children:"Xoá"})})})]})})]},i._id))})]})}),f("div",{className:`sticky bottom-0 z-10 mt-10 flex flex-col  rounded-sm border border-gray-200 bg-white p-5
         shadow sm:flex-row sm:items-center`,children:[f("div",{className:"flex items-center justify-center sm:justify-start",children:[s("div",{className:"flex flex-shrink-0 items-center justify-center pr-3",children:s("input",{type:"checkbox",className:"h-4 w-4 accent-orange",checked:h,onChange:w})}),f("button",{onClick:w,className:"mx-3 border-none bg-none",children:["Chọn tất cả (",t.length,")"]}),s("button",{onClick:B,className:"mx-3 border-none bg-none",children:"Xoá"})]}),f("div",{className:"mt-5 flex flex-col items-center justify-center sm:ml-auto sm:mt-0 sm:flex-row",children:[f("div",{children:[f("div",{className:"flex items-center justify-center sm:flex-row sm:justify-end",children:[f("div",{children:["Tổng thanh toán (",P," sản phẩm):"]}),f("div",{className:"ml-2 text-2xl text-orange",children:["₫",E(g)]})]}),f("div",{className:"flex items-center justify-center text-sm sm:justify-end",children:[s("div",{className:"text-gray-500",children:"Tiết kiệm:"}),f("div",{className:"ml-6 text-orange",children:["₫",E(j)]})]})]}),s($e,{onClick:je,disabled:o.isLoading,className:`ml-4 mt-5 flex h-10 w-44 items-center justify-center 
              bg-orange text-sm uppercase text-white hover:bg-orange/80 sm:mt-0`,children:"Mua hàng"})]})]})]}),!(t.length>0)&&f("div",{className:"py-20",children:[s("div",{className:" flex items-center justify-center pt-10",children:s("img",{className:"h-36 w-36",src:"src/images/no-product.png",alt:"no purchases"})}),s("div",{className:"flex items-center justify-center",children:s("span",{className:"",children:"Giỏ hàng của bạn còn trống"})}),s("div",{className:"flex items-center justify-center",children:s(X,{to:G.home,className:"mt-5 flex h-10 w-44 items-center justify-center bg-orange text-sm uppercase text-white hover:bg-orange/80",children:"MUA NGAY"})})]})]})})}export{Ct as default};
